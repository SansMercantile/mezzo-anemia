# sans-mercantile-app/backend/mezzo_anima_line/Dockerfile
# Set environment variables for Python best practices
ENV PYTHONUNBUFFERED=1
ENV PYTHONDONTWRITEBYTECODE=1

WORKDIR /app

# --- ARG declarations for receiving secrets from GitHub Actions ---
ARG ACCESS_KEY_ID
ARG ALLOWED_ORIGINS
ARG ALPACA_BASE_URL
ARG ALPACA_PAPER_API_KEY_ID
ARG ALPACA_PAPER_SECRET_KEY
ARG ALPACA_SANDBOX_API_KEY_ID
ARG ALPACA_SANDBOX_SECRET_KEY
ARG ALPHA_VANTAGE_API
ARG AZURE_OPENAI_API_VERSION
ARG AZURE_OPENAI_DEPLOYMENT_NAME
ARG AZURE_OPENAI_ENDPOINT
ARG AZURE_OPENAI_KEY
ARG BINANCE_API_KEY
ARG BINANCE_BASE_URL
ARG BINANCE_SECRET_KEY
ARG BINANCE_WEBSOCKET_URL
ARG DB_NAME
ARG DB_PASS
ARG DB_USER
ARG DERIV_APP_CONSOLE_API_TOKEN
ARG DERIV_APP_CONSOLE_APP_ID
ARG DERIV_APP_NAME
ARG DERIV_PRIV1_API_TOKEN
ARG DERIV_PRIV1_APP_ID
ARG D_ID_API_KEY
ARG ENABLE_ALPACA_ADAPTER
ARG ENABLE_ALPACA_PAPER_ADAPTER
ARG ENABLE_ALPACA_SANDBOX_ADAPTER
ARG ENABLE_AZURE_OPENAI_ADAPTER
ARG ENABLE_DERIV_ADAPTER
ARG ENABLE_DERIV_APP_CONSOLE_ADAPTER
ARG ENABLE_DERIV_PRIV1_ADAPTER
ARG ENABLE_MOCK_ADAPTER
ARG ENABLE_MT5_ADAPTER
ARG EODHD_API_KEY
ARG EODHD_BASE_URL
ARG FBS_COMPANY_NAME_IN_MT
ARG FBS_DEMO_LOGIN_ID
ARG FBS_DEMO_PASSWORD
ARG FBS_DEMO_SEVER
ARG FBS_IB_LINK
ARG FBS_REAL_LOGIN_ID
ARG FBS_REAL_PASSWORD
ARG FBS_REAL_SEVER
ARG FINNHUB_API_KEY
ARG FINNHUB_SECRET
ARG GCP_PROJECT_ID
ARG GCP_REGION
ARG GEMINI_API_KEY
ARG GMAIL_SERVICE_ACCOUNT_SECRET_NAME
ARG INSTANCE_CONNECTION_NAME
ARG KILL_SWITCH_AI_TRADING
ARG LLM_MODEL_NAME
ARG MPETI_EMAIL_ADDRESS
ARG MT5_ACCOUNT
ARG MT5_PASSWORD
ARG MT5_SERVER
ARG NEWS_API_KEY_AI
ARG NEWS_API_KEY_ORG
ARG OPENAI_API_KEY
ARG POLYGON_ACCESS_KEY_ID
ARG POLYGON_API_KEY
ARG POLYGON_BUCKET
ARG POLYGON_NAME
ARG POLYGON_S3_ENDPOINT
ARG PUBLIC_IP_ADDRESS
ARG SECRET
ARG SIMFIN_API_KEY
ARG SIMFIN_BASE_URL
ARG TRADING_STRATEGY_MODE
ARG TWELVEDATA_API_KEY

COPY . /app

# --- Set ENV variables to make secrets available at runtime ---
ENV ACCESS_KEY_ID=$ACCESS_KEY_ID
ENV ALLOWED_ORIGINS=$ALLOWED_ORIGINS
ENV ALPACA_BASE_URL=$ALPACA_BASE_URL
ENV ALPACA_PAPER_API_KEY_ID=$ALPACA_PAPER_API_KEY_ID
ENV ALPACA_PAPER_SECRET_KEY=$ALPACA_PAPER_SECRET_KEY
ENV ALPACA_SANDBOX_API_KEY_ID=$ALPACA_SANDBOX_API_KEY_ID
ENV ALPACA_SANDBOX_SECRET_KEY=$ALPACA_SANDBOX_SECRET_KEY
ENV ALPHA_VANTAGE_API=$ALPHA_VANTAGE_API
ENV AZURE_OPENAI_API_VERSION=$AZURE_OPENAI_API_VERSION
ENV AZURE_OPENAI_DEPLOYMENT_NAME=$AZURE_OPENAI_DEPLOYMENT_NAME
ENV AZURE_OPENAI_ENDPOINT=$AZURE_OPENAI_ENDPOINT
ENV AZURE_OPENAI_KEY=$AZURE_OPENAI_KEY
ENV BINANCE_API_KEY=$BINANCE_API_KEY
ENV BINANCE_BASE_URL=$BINANCE_BASE_URL
ENV BINANCE_SECRET_KEY=$BINANCE_SECRET_KEY
ENV BINANCE_WEBSOCKET_URL=$BINANCE_WEBSOCKET_URL
ENV DB_NAME=$DB_NAME
ENV DB_PASS=$DB_PASS
ENV DB_USER=$DB_USER
ENV DERIV_APP_CONSOLE_API_TOKEN=$DERIV_APP_CONSOLE_API_TOKEN
ENV DERIV_APP_CONSOLE_APP_ID=$DERIV_APP_CONSOLE_APP_ID
ENV DERIV_APP_NAME=$DERIV_APP_NAME
ENV DERIV_PRIV1_API_TOKEN=$DERIV_PRIV1_API_TOKEN
ENV DERIV_PRIV1_APP_ID=$DERIV_PRIV1_APP_ID
ENV D_ID_API_KEY=$D_ID_API_KEY
ENV ENABLE_ALPACA_ADAPTER=$ENABLE_ALPACA_ADAPTER
ENV ENABLE_ALPACA_PAPER_ADAPTER=$ENABLE_ALPACA_PAPER_ADAPTER
ENV ENABLE_ALPACA_SANDBOX_ADAPTER=$ENABLE_ALPACA_SANDBOX_ADAPTER
ENV ENABLE_AZURE_OPENAI_ADAPTER=$ENABLE_AZURE_OPENAI_ADAPTER
ENV ENABLE_DERIV_ADAPTER=$ENABLE_DERIV_ADAPTER
ENV ENABLE_DERIV_APP_CONSOLE_ADAPTER=$ENABLE_DERIV_APP_CONSOLE_ADAPTER
ENV ENABLE_DERIV_PRIV1_ADAPTER=$ENABLE_DERIV_PRIV1_ADAPTER
ENV ENABLE_MOCK_ADAPTER=$ENABLE_MOCK_ADAPTER
ENV ENABLE_MT5_ADAPTER=$ENABLE_MT5_ADAPTER
ENV EODHD_API_KEY=$EODHD_API_KEY
ENV EODHD_BASE_URL=$EODHD_BASE_URL
ENV FBS_COMPANY_NAME_IN_MT=$FBS_COMPANY_NAME_IN_MT
ENV FBS_DEMO_LOGIN_ID=$FBS_DEMO_LOGIN_ID
ENV FBS_DEMO_PASSWORD=$FBS_DEMO_PASSWORD
ENV FBS_DEMO_SEVER=$FBS_DEMO_SEVER
ENV FBS_IB_LINK=$FBS_IB_LINK
ENV FBS_REAL_LOGIN_ID=$FBS_REAL_LOGIN_ID
ENV FBS_REAL_PASSWORD=$FBS_REAL_PASSWORD
ENV FBS_REAL_SEVER=$FBS_REAL_SEVER
ENV FINNHUB_API_KEY=$FINNHUB_API_KEY
ENV FINNHUB_SECRET=$FINNHUB_SECRET
ENV GCP_PROJECT_ID=$GCP_PROJECT_ID
ENV GCP_REGION=$GCP_REGION
ENV GEMINI_API_KEY=$GEMINI_API_KEY
ENV GMAIL_SERVICE_ACCOUNT_SECRET_NAME=$GMAIL_SERVICE_ACCOUNT_SECRET_NAME
ENV INSTANCE_CONNECTION_NAME=$INSTANCE_CONNECTION_NAME
ENV KILL_SWITCH_AI_TRADING=$KILL_SWITCH_AI_TRADING
ENV LLM_MODEL_NAME=$LLM_MODEL_NAME
ENV MPETI_EMAIL_ADDRESS=$MPETI_EMAIL_ADDRESS
ENV MT5_ACCOUNT=$MT5_ACCOUNT
ENV MT5_PASSWORD=$MT5_PASSWORD
ENV MT5_SERVER=$MT5_SERVER
ENV NEWS_API_KEY_AI=$NEWS_API_KEY_AI
ENV NEWS_API_KEY_ORG=$NEWS_API_KEY_ORG
ENV OPENAI_API_KEY=$OPENAI_API_KEY
ENV POLYGON_ACCESS_KEY_ID=$POLYGON_ACCESS_KEY_ID
ENV POLYGON_API_KEY=$POLYGON_API_KEY
ENV POLYGON_BUCKET=$POLYGON_BUCKET
ENV POLYGON_NAME=$POLYGON_NAME
ENV POLYGON_S3_ENDPOINT=$POLYGON_S3_ENDPOINT
ENV PUBLIC_IP_ADDRESS=$PUBLIC_IP_ADDRESS
ENV SECRET=$SECRET
ENV SIMFIN_API_KEY=$SIMFIN_API_KEY
ENV SIMFIN_BASE_URL=$SIMFIN_BASE_URL
ENV TRADING_STRATEGY_MODE=$TRADING_STRATEGY_MODE
ENV TWELVEDATA_API_KEY=$TWELVEDATA_API_KEY

# Add the new library directory to the system's library path
ENV LD_LIBRARY_PATH=/app/lib:$LD_LIBRARY_PATH

CMD ["python", "anima_engine.py"]
